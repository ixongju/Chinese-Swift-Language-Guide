# é”™è¯¯å¤„ç†

é”™è¯¯å¤„ç†æ˜¯å“åº”ç¨‹åºä¸­çš„é”™è¯¯æ¡ä»¶ï¼Œå¹¶ä»é”™è¯¯ä¸­æ¢å¤çš„è¿‡ç¨‹ã€‚Swiftä¸ºåœ¨è¿è¡Œæ—¶æŠ›å‡ºï¼Œæ•è·ï¼Œä¼ é€’å’Œæ“ä½œå¯æ¢å¤é”™è¯¯æä¾›äº†æœ€é«˜çº§åˆ«çš„æ”¯æŒã€‚

æœ‰ä¸€äº›æ“ä½œå¹¶ä¸èƒ½ä¿è¯æ€»æ˜¯èƒ½å®Œæˆæ‰§è¡Œæˆ–äº§ç”Ÿæœ‰ç”¨çš„è¾“å‡ºã€‚å¯é€‰å€¼ç”¨æ¥å‘ˆç°æŸä¸€ä¸ªå€¼ï¼Œä½†æ˜¯å½“ä¸€ä¸ªæ“ä½œå¤±è´¥æ—¶ï¼Œèƒ½å¼„æ‡‚ä»€ä¹ˆå¯¼è‡´äº†å¤±è´¥æ¯”è¾ƒæœ‰ç”¨ï¼Œé‚£æ ·ä½ çš„ä»£ç å°±å¯ä»¥ä½œå‡ºç›¸åº”çš„å“åº”ã€‚

ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸‹ä»ç£ç›˜æ–‡ä»¶ä¸­è¯»å–å¹¶å¤„ç†æ•°æ®çš„ä»»åŠ¡ã€‚è¿™ä¸ªä»»åŠ¡æœ‰å¤šç§å¤±è´¥çš„å¯èƒ½ï¼ŒåŒ…æ‹¬æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ–‡ä»¶æ²¡æœ‰è¯»å–æƒé™ï¼Œæˆ–æ–‡ä»¶ç¼–ç æ ¼å¼ä¸å…¼å®¹ã€‚åŒºåˆ†è¿™äº›é”™è¯¯æƒ…å½¢èƒ½è®©ç¨‹åºè§£å†³ä¸€äº›é”™è¯¯ï¼Œå¹¶å¯ä»¥å‘Šè¯‰ç”¨æˆ·ä¸€äº›é”™è¯¯æ— æ³•è§£å†³ã€‚

> æ³¨æ„ï¼š
> Swiftä¸­çš„é”™è¯¯å¤„ç†ä¸Cocoaå’ŒObjective-Cä¸­çš„`NSError`ç±»çš„é”™è¯¯å¤„ç†æ¨¡å¼ç›¸äº’åè°ƒã€‚å…³äºæ­¤ç±»çš„æ›´å¤šä¿¡æ¯ï¼Œå‚è§[Handling Cocoa Errors in Swift](https://developer.apple.com/documentation/swift/cocoa_design_patterns/handling_cocoa_errors_in_swift)ã€‚

## è¡¨è¾¾å¹¶æŠ›å‡ºé”™è¯¯

åœ¨Swiftä¸­ï¼Œç”¨å®ç°äº†`Error`åè®®ç±»å‹çš„å€¼è¡¨è¾¾é”™è¯¯ã€‚è¿™ä¸ªç©ºåè®®è¡¨æ˜ä¸€ä¸ªç±»å‹å¯ä»¥ç”¨æ¥å¤„ç†é”™è¯¯ã€‚

Swiftä¸­çš„æšä¸¾æ›´é€‚åˆä¸ºä¸€ç»„ç›¸å…³çš„é”™è¯¯æ¡ä»¶å»ºæ¨¡ï¼Œç”¨å…³è”å€¼åˆ™å¯ä»¥è¡¨è¾¾ä¸è¦å¤„ç†é”™è¯¯æœ¬è´¨ç›¸å…³çš„é¢å¤–ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è¿™æ ·è¡¨è¾¾åœ¨æ¸¸æˆä¸­æ“ä½œè‡ªåŠ¨å”®è´§æœºçš„é”™è¯¯æ¡ä»¶ï¼š
```swift
enum VendingMachineError: Error {
    case invalidSelection
    case insufficientFunds(coinsNeeded: Int)
    case outOfStock
}
```

æŠ›å‡ºä¸€ä¸ªé”™è¯¯è¡¨æ˜å‘ç”Ÿå¼‚å¸¸ï¼Œæ­£å¸¸çš„æµç¨‹æ— æ³•ç»§ç»­ã€‚ç”¨`throw`è¯­å¥æŠ›å‡ºé”™è¯¯ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æŠ›å‡ºä¸€ä¸ªé”™è¯¯è¡¨æ˜è‡ªåŠ¨å”®è´§æœºéœ€è¦é¢å¤–äº”æšç¡¬å¸ï¼š
```swift
throw VendingMachineError.insufficientFunds(coinsNeeded: 5)
```

## å¤„ç†é”™è¯¯

å½“ä¸€ä¸ªé”™è¯¯è¢«æŠ›å‡ºï¼Œé”™è¯¯å‘¨å›´çš„ä»£ç ç‰‡æ®µå¿…é¡»ä¸ºå¤„ç†é”™è¯¯ä½œå‡ºååº”---ä¾‹å¦‚ï¼Œä¿®å¤é—®é¢˜ï¼Œå°è¯•å¦ä¸€ä¸ªæ“ä½œæˆ–é€šçŸ¥ç”¨æˆ·å¤±è´¥ã€‚

åœ¨Swiftä¸­æœ‰å››ç§å¤„ç†é”™è¯¯çš„æ–¹æ³•ã€‚å¯ä»¥æŠŠé”™è¯¯ä»å‡½æ•°ä¼ é€’åˆ°è°ƒç”¨è¯¥å‡½æ•°çš„ä»£ç ï¼Œç”¨`do-catch`è¯­å¥ï¼Œå°†é”™è¯¯å½“ä½œå¯é€‰å€¼å¤„ç†æˆ–æ–­è¨€è¯¥é”™è¯¯ä¸ä¼šå‘ç”Ÿã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»ã€‚

å‡½æ•°æŠ›å‡ºé”™è¯¯æ—¶ï¼Œä¼šæ”¹å˜ç¨‹åºæµç¨‹ï¼Œæ‰€ä»¥èƒ½å¿«é€Ÿå®šä½æŠ›å‡ºé”™è¯¯çš„ä»£ç å¾ˆé‡è¦ã€‚ä¸ºäº†å®šä½è¿™äº›é”™è¯¯ï¼Œåœ¨è°ƒç”¨å¯èƒ½æŠ›å‡ºé”™è¯¯çš„å‡½æ•°ï¼Œæ–¹æ³•æˆ–åˆå§‹åŒ–æ–¹æ³•å‰å†™ä¸Š`try`å…³é”®å­—---æˆ–`try?`æˆ–`try!`å˜ä½“ã€‚è¿™äº›å…³é”®å­—åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­æœ‰æè¿°ã€‚

> æ³¨æ„ï¼š
> Swiftä¸­çš„é”™è¯¯å¤„ç†ä¸å…¶ä»–è¯­è¨€ä¸­çš„å¼‚å¸¸å¤„ç†ç›¸ä¼¼ï¼Œéƒ½ç”¨äº†`try`ï¼Œ`catch`å’Œ`throw`ç­‰å…³é”®å­—ã€‚ä¸å…¶ä»–è®¸å¤šè¯­è¨€â€“â€“â€“åŒ…æ‹¬Objective-Câ€“â€“â€“çš„å¼‚å¸¸å¤„ç†ä¸åŒçš„æ˜¯ï¼ŒSwiftä¸­çš„é”™è¯¯å¤„ç†ä¸æ¶‰åŠå±•å¼€è°ƒç”¨å †æ ˆï¼Œè¿™æ˜¯ä¸€ä¸ªè®¡ç®—æˆæœ¬é«˜æ˜‚çš„è¿‡ç¨‹ã€‚å› æ­¤ï¼Œ`throw`è¯­å¥çš„è¡¨ç°ç‰¹æ€§ç›¸å½“äºä¸€ä¸ª`return`è¯­å¥ã€‚ï¼ˆè¯‘è€…ï¼šğŸ‚ğŸ‘ƒå‘€ï¼‰

### ç”¨æŠ¥é”™å‡½æ•°ä¼ é€’é”™è¯¯

ä¸ºäº†è¡¨æ˜ä¸€ä¸ªå‡½æ•°ï¼Œæ–¹æ³•ååˆå§‹åŒ–æ–¹æ³•å¯ä»¥æŠ›å‡ºé”™è¯¯ï¼Œä½ å¯ä»¥åœ¨å‡½æ•°å£°æ˜çš„å‚æ•°åé¢å†™ä¸Š`throws`å…³é”®å­—ã€‚ç”¨`throws`å…³é”®å­—æ ‡è®°çš„å‡½æ•°ç§°ä¸º*æŠ¥é”™å‡½æ•°*ã€‚å¦‚æœå‡½æ•°æŒ‡å®šäº†è¿”å›ç±»å‹ï¼Œåˆ™åœ¨è¿”å›ç®­å¤´(`->`)å‰é¢å†™ä¸Š`throws`å…³é”®å­—ã€‚
```swift
func canThrowErrors() throws -> String

func cannotThrowErrors() -> String
```

ä¸€ä¸ªæŠ¥é”™å‡½æ•°å°†å…¶å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¼ é€’ç»™è°ƒç”¨è¯¥å‡½æ•°çš„ä»£ç å—ã€‚

> æ³¨æ„ï¼š
> åªæœ‰æŠ¥é”™å‡½æ•°èƒ½ä¼ é€’é”™è¯¯ã€‚ä»»ä½•åœ¨éæŠ¥é”™å‡½æ•°å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯å¿…é¡»åœ¨å…¶å†…éƒ¨å¤„ç†ã€‚

ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç±»`VendingMachine`æœ‰ä¸€ä¸ªæ–¹æ³•`vend(itemNamed:)`ï¼Œå¦‚æœè¯·æ±‚çš„é¡¹ä¸å¯ç”¨ï¼Œç¼ºè´§æˆ–éœ€è¦è¶…å‡ºå½“å‰é‡‘é¢çš„è´¹ç”¨æ—¶ï¼Œå°±æŠ›å‡ºç›¸åº”`VendingMachineError`é”™è¯¯ï¼š
```swift
struct Item {
    var price: Int
    var count: Int
}

class VendingMachine {
    var inventory = [
      "Candy Bar": Item(price: 12, count: 7),
      "Chips": Item(price: 10, count: 4),
      "Pretzels": Item(price: 7, count: 11)
    ]
    var coinsDeposited = 0

    func vend(itemNamed name: String) throws {
        guard let item = inventory[name] else {
            throw VendingMachineError.invalidSelection
        }

        guard item.count > 0 else {
            throw VendingMachineError.outOfStock
        }

        guard item.price <= coinsDeposited else {
            throw VendingMachineError.insufficientFunds(coinsNeeded: item.price - coinsDeposited)
        }

        coinsDeposited -= item.price

        var newItem = item
        newItem.count -= 1
        inventory[name] = newItem

        print("Dispensing \(name)")
    }
}
```

`vend(itemNamed:)`æ–¹æ³•çš„å£°æ˜ä¸­ï¼Œç”¨`guard`è¯­å¥æå‰é€€å‡ºæ–¹æ³•ï¼Œå¹¶åœ¨ä»»ä½•è´­ä¹°ç³–æœçš„è¦æ±‚ä¸è¢«æ»¡è¶³æ—¶æŠ›å‡ºç›¸åº”çš„é”™è¯¯ã€‚å› ä¸º`throw`è¯­å¥ç«‹å³è½¬ç§»äº†ç¨‹åºæµç¨‹ï¼Œåªæœ‰å½“æ‰€æœ‰çš„è¦æ±‚éƒ½è¢«æ»¡è¶³æ—¶æ‰ä¼šå”®å‡ºä¸€ä¸ªè´§ç‰©ã€‚

å› ä¸º`vend(itemNamed:)`æ–¹æ³•ä¼šä¼ é€’ä»»ä½•æŠ›å‡ºçš„é”™è¯¯ï¼Œä»»ä½•è°ƒç”¨æ­¤æ–¹æ³•çš„ä»£ç å¿…é¡»å¤„ç†é”™è¯¯---ç”¨`do-catch`è¯­å¥ï¼Œæˆ–ç”¨`try?`æˆ–`try!`---ä¼ é€’å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ä¾‹å­ä¸­çš„`buyFavoriteSnack(person:vendingMachine:)`ä¹Ÿæ˜¯ä¸€ä¸ªæŠ¥é”™å‡½æ•°ï¼Œ`vend(itemNamed:)`æŠ›å‡ºçš„ä»»ä½•é”™è¯¯éƒ½ä¼šä¼ é€’åˆ°`buyFavoriteSnack(person:vendingMachine:)`å‡½æ•°è¢«è°ƒç”¨çš„åœ°æ–¹ã€‚
```swift
let favoriteSnacks = [
    "Alice": "Chips",
    "Bob": "Licorice",
    "Eve": "Pretzels",
]
func buyFavoriteSnack(person: String, vendingMachine: VendingMachine) throws {
    let snackName = favoriteSnacks[person] ?? "Candy Bar"
    try vendingMachine.vend(itemNamed: snackName)
}
```

è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`buyFavoriteSnack(person:vendingMachine:)`å‡½æ•°æŸ¥æ‰¾ç»™å®šäººç‰©æœ€å–œæ¬¢çš„ç³–æœï¼Œç„¶åè¯•å›¾é€šè¿‡è°ƒç”¨`vend(itemNamed:)`æ–¹æ³•è´­ä¹°ã€‚å› ä¸º`vend(itemNamed:)`æ–¹æ³•å¯ä»¥æŠ›å‡ºé”™è¯¯ï¼Œæ‰€ä»¥åœ¨æ–¹æ³•åä¹‹å‰å†™ä¸Š`try`å…³é”®å­—æ¥è°ƒç”¨ã€‚

æŠ¥é”™åˆå§‹åŒ–æ–¹æ³•ä¸æŠ¥é”™å‡½æ•°ä¸€æ ·å¯ä»¥ä¼ é€’é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„`PurchasedSnack`ç»“æ„ä½“çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œè°ƒç”¨ä¸€ä¸ªæŠ¥é”™å‡½æ•°ä½œä¸ºåˆå§‹åŒ–å¤„ç†çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä¼šé€šè¿‡å°†é‡åˆ°çš„é”™è¯¯ä¼ é€’ç»™è°ƒç”¨è€…çš„æ–¹å¼å¤„ç†é”™è¯¯ã€‚
```swift
struct PurchasedSnack {
    let name: String
    init(name: String, vendingMachine: VendingMachine) throws {
        try vendingMachine.vend(itemNamed: name)
        self.name = name
    }
}
```

### ç”¨`Do-Catch`å¤„ç†é”™è¯¯

ç”¨`do-catch`è¯­å¥æ‰§è¡Œä¸€ä¸ªè¯­å¥å—æ¥å¤„ç†é”™è¯¯ã€‚å¦‚æœä¸€ä¸ªé”™è¯¯åœ¨`do`å­å¥ä¸­è¢«æŠ›å‡ºï¼Œä¼šè¢«ç”¨äºåŒ¹é…`catch`å­å¥ï¼Œä»¥å†³å®šå“ªä¸€ä¸ª`catch`å­å¥å¯ä»¥å¤„ç†é”™è¯¯ï¼š

ä¸‹é¢æ˜¯`do-catch`è¯­å¥çš„ä¸€èˆ¬æ ¼å¼ï¼š
```swift
do {
    try expression
    statements
} catch pattern 1 {
    statements
} catch pattern 2 where condition {
    statements
} catch {
    statements
}
```

åœ¨`catch`åé¢å†™ä¸Šæ¨¡å¼æ¥è¡¨æ˜è¯¥å­å¥å¯ä»¥å¤„ç†ä»€ä¹ˆé”™è¯¯ã€‚å¦‚æœ`catch`å­å¥æ²¡æœ‰æ¨¡å¼ï¼Œåˆ™è¯¥å­å¥åŒ¹é…ä»»ä½•é”™è¯¯ï¼Œä¸”å°†é”™è¯¯ç»‘å®šç»™ä¸€ä¸ªå±€éƒ¨å¸¸é‡`error`ã€‚å…³äºæ¨¡å¼åŒ¹é…çš„æ›´å¤šä¿¡æ¯ï¼Œå‚è§[æ¨¡å¼](../Language_Reference/Patterns.md)ã€‚

ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç åŒ¹é…`VendingMachineError`æšä¸¾çš„ä¸‰ä¸ªåˆ†æ”¯ï¼š
```swift
var vendingMachine = VendingMachine()
vendingMachine.coinsDeposited = 8
do {
    try buyFavoriteSnack(person: "Alice", vendingMachine: vendingMachine)
    print("Success! Yum.")
} catch VendingMachineError.invalidSelection {
    print("Invalid Selection.")
} catch VendingMachineError.outOfStock {
    print("Out of Stock.")
} catch VendingMachineError.insufficientFunds(let coinsNeeded) {
    print("Insufficient funds. Please insert an additional \(coinsNeeded) coins.")
} catch {
    print("Unexpected error: \(error).")
}
// Prints "Insufficient funds. Please insert an additional 2 coins."
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå› ä¸ºèƒ½æŠ›å‡ºé”™è¯¯ï¼Œå‡½æ•°`buyFavoriteSnack(person:vendingMachine:)`è¢«`try`è¯­å¥è°ƒç”¨ã€‚å¦‚æœæŠ›å‡ºäº†é”™è¯¯ï¼Œä»£ç æ‰§è¡Œä¼šç«‹å³è·³è½¬åˆ°`catch`å­å¥ï¼Œè¯¥å­å¥å†³å®šæ˜¯å¦å…è®¸ç»§ç»­ä¼ é€’é”™è¯¯ã€‚å¦‚æœåŒ¹é…çš„æ¨¡å¼ï¼Œé”™è¯¯ä¼šè¢«æœ€åçš„`catch`å­å¥æ•è·ï¼Œå¹¶è¢«æ‰“åŒ…åœ¨å±€éƒ¨å¸¸é‡`error`ä¸­ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯æŠ›å‡ºï¼Œ`do`è¯­å¥ä¸­å‰©ä¸‹çš„è¯­å¥ä¼šè¢«æ‰§è¡Œã€‚

`catch`å­å¥ä¸éœ€è¦å¤„ç†æ¯ä¸€ä¸ªå¯èƒ½ä»`do`è¯­å¥ä¸­æŠ›å‡ºçš„é”™è¯¯ã€‚å¦‚æœæ²¡æœ‰`catch`å­å¥å¤„ç†é”™è¯¯ï¼Œé”™è¯¯å°†è¢«ä¼ é€’åˆ°å‘¨å›´çš„åŒºåŸŸã€‚ä½†æ˜¯ï¼Œä¼ é€’çš„é”™è¯¯å¿…é¡»è¢«å‘¨å›´çš„ä»£ç å¤„ç†ã€‚åœ¨ä¸€ä¸ªéæŠ¥é”™å‡½æ•°ä¸­ï¼Œä¸€ä¸ªå°é—­çš„`do-catch`å¿…é¡»å¤„ç†é”™è¯¯ã€‚åœ¨æŠ¥é”™å‡½æ•°ä¸­ï¼Œ`do-catch`æˆ–è°ƒç”¨è€…å¿…é¡»å¤„ç†é”™è¯¯ã€‚å¦‚æœä¸å¤„ç†é”™è¯¯ä»»ç”±å…¶è¢«ä¼ é€’åˆ°äº†é¡¶çº§ä½œç”¨åŸŸï¼Œå°†ä¼šå¾—åˆ°ä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯ã€‚

ä¾‹å¦‚ï¼Œä¸Šé¢çš„ä¾‹å­å¯ä»¥è¿™æ ·å†™ï¼Œä»»ä½•é`VendingMachineError`çš„é”™è¯¯ä¼šè¢«å‡½æ•°æ•è·ï¼š
```swift
func nourish(with item: String) throws {
    do {
        try vendingMachine.vend(itemNamed: item)
    } catch is VendingMachineError {
        print("Invalid selection, out of stock, or not enough money.")
    }
}

do {
    try nourish(with: "Beet-Flavored Chips")
} catch {
    print("Unexpected non-vending-machine-related error: \(error)")
}
// Prints "Invalid selection, out of stock, or not enough money."
```

åœ¨`nourish(with:)`å‡½æ•°ä¸­ï¼Œå¦‚æœ`vend(itemNamed:)`æŠ›å‡ºæšä¸¾`VendingMachineError`ä¸­çš„ä¸€ä¸ªé”™è¯¯ï¼Œ`nourish(with:)`ä¼šé€šè¿‡æ‰“å°ä¿¡æ¯æ¥å¤„ç†é”™è¯¯ã€‚å¦åˆ™ï¼Œ`nourish(with:)`å°†é”™è¯¯ä¼ é€’åˆ°è¢«è°ƒç”¨çš„åœ°æ–¹ã€‚ç„¶åï¼Œé”™è¯¯ä¼šè¢«ä¸€èˆ¬çš„`catch`å­å¥æ•è·ã€‚

### å°†é”™è¯¯è½¬æ¢ä¸ºå¯é€‰å€¼

ç”¨`try?`å°†é”™è¯¯è½¬æ¢ä¸ºå¯é€‰å€¼æ¥å¤„ç†é”™è¯¯ã€‚å¦‚æœè®¡ç®—`try?`è¡¨è¾¾å¼æ—¶æŠ›å‡ºäº†é”™è¯¯ï¼Œåˆ™è¯¥è¡¨è¾¾å¼çš„å€¼ä¸º`nil`ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ä»£ç ä¸­çš„`x`å’Œ`y`æœ‰ç›¸åŒçš„å€¼å’Œè¡Œä¸ºï¼š
```swift
func someThrowingFunction() throws -> Int {
    // ...
}

let x = try? someThrowingFunction()

let y: Int?
do {
    y = try someThrowingFunction()
} catch {
    y = nil
}
```

å¦‚æœå‡½æ•°`someThrowingFunction()`æŠ›å‡ºé”™è¯¯ï¼Œ`x`å’Œ`y`çš„å€¼å°±æ˜¯`nil`ã€‚å¦åˆ™ï¼Œ`x`å’Œ`y`çš„å€¼å°±æ˜¯å‡½æ•°çš„è¿”å›å€¼ã€‚æ³¨æ„`x`å’Œ`y`æ˜¯`someThrowingFunction()`è¿”å›ç±»å‹çš„å¯é€‰ç±»å‹ã€‚è¿™é‡Œå‡½æ•°è¿”å›ä¸€ä¸ªæ•´å‹ï¼Œæ‰€ä»¥`x`å’Œ`y`æ˜¯å¯é€‰æ•´å‹ã€‚

å½“æƒ³ç”¨ç›¸åŒæ–¹å¼å¤„ç†é”™è¯¯æ—¶ï¼Œç”¨`try?`å¯ä»¥ä½¿ä½ ç¼–å†™ç®€æ´çš„é”™è¯¯å¤„ç†ä»£ç ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ç”¨å‡ ä¸ªæ­¥éª¤è·å–æ•°æ®ï¼Œæˆ–è€…ï¼Œå¦‚æœæ‰€æœ‰çš„æ­¥éª¤éƒ½å¤±è´¥ï¼Œå°±è¿”å›`nil`ã€‚
```swift
func fetchData() -> Data? {
    if let data = try? fetchDataFromDisk() { return data }
    if let data = try? fetchDataFromServer() { return data }
    return nil
}
```

### ç¦ç”¨é”™è¯¯ä¼ é€’

äº‹å®ä¸Šï¼Œæœ‰æ—¶å€™ä½ çŸ¥é“ä¸€ä¸ªæŠ¥é”™æ–¹æ³•æˆ–æŠ¥é”™å‡½æ•°ä¸ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºé”™è¯¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨è¡¨è¾¾å¼å‰å†™ä¸Š`try!`æ¥ç¦ç”¨é”™è¯¯ä¼ é€’ï¼Œå¹¶å°†è°ƒç”¨æ‹¬åœ¨ä¸ä¼šæŠ›å‡ºé”™è¯¯çš„è¿è¡Œæ—¶æ–­è¨€ä¸­ã€‚å¦‚æœçœŸçš„æœ‰é”™è¯¯æŠ›å‡ºï¼Œä½ å°†è·å¾—ä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ä»£ç ä½¿ç”¨äº†ä¸€ä¸ªå‡½æ•°`loadImage(atPath:)`ï¼Œè¯¥å‡½æ•°ä¼šåŠ è½½æŒ‡å®šè·¯å¾„çš„å›¾ç‰‡èµ„æºï¼Œå¦‚æœä¸èƒ½åŠ è½½å›¾ç‰‡å°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå› ä¸ºå›¾ç‰‡æ˜¯éšé™„åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œåœ¨è¿è¡Œæ—¶ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œæ‰€ä»¥ç¦ç”¨é”™è¯¯ä¼ é€’æ¯”è¾ƒåˆé€‚ã€‚
```swift
let photo = try! loadImage(atPath: "./Resources/JohnAppleseed.jpg")
```

## æŒ‡å®šæ¸…ç†æ“ä½œ

ç”¨`defer`è¯­å¥åœ¨ä»£ç æ‰§è¡Œå³å°†ç¦»å¼€å½“å‰ä»£ç å—æ—¶æ‰§è¡Œä¸€ç»„è¯­å¥ã€‚ä¸ç®¡ä»£ç æ‰§è¡Œå¦‚ä½•ç¦»å¼€å½“å‰ä»£ç å—---æ— è®ºæ˜¯å› ä¸ºæŠ›å‡ºé”™è¯¯è€Œç¦»å¼€è¿˜æ˜¯å› ä¸ºè¯¸å¦‚`return`æˆ–`break`è¿™æ ·çš„è¯­å¥è€Œç¦»å¼€ï¼Œè¿™ä¸ªè¯­å¥èƒ½è®©ä½ æ‰§è¡Œå¿…è¦çš„æ¸…ç†æ“ä½œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ç”¨`defer`è¯­å¥ç¡®ä¿æ–‡ä»¶æè¿°ç¬¦è¢«å…³é—­ï¼Œæ‰‹åŠ¨åˆ†é…çš„å†…å­˜è¢«é‡Šæ”¾ã€‚

ä¸€ä¸ª`defer`è¯­å¥å»¶è¿Ÿåˆ°é€€å‡ºå½“å‰ä½œç”¨åŸŸæ—¶æ‰æ‰§è¡Œã€‚è¿™ä¸ªè¯­å¥ç”±`defer`å…³é”®å­—å’Œå…¶åéœ€è¦è¢«æ‰§è¡Œçš„è¯­å¥ç»„æˆã€‚å»¶è¿Ÿæ‰§è¡Œè¯­å¥ä¸èƒ½åŒ…å«è·³å‡ºè¯­å¥æ§åˆ¶æµçš„ä»£ç ï¼Œä¾‹å¦‚`break`æˆ–`return`è¯­å¥ï¼Œæˆ–æŠ›å‡ºé”™è¯¯ã€‚å»¶è¿Ÿæ“ä½œä»¥ä¹¦å†™ä»£ç é¡ºåºçš„é€†åºè¢«æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯ï¼Œ`defer`è¯­å¥çš„ç¬¬ä¸€è¡Œä»£ç æœ€åè¢«æ‰§è¡Œï¼Œç¬¬äºŒè¡Œä»£ç å€’æ•°ç¬¬äºŒè¢«æ‰§è¡Œï¼Œç­‰ç­‰ã€‚ä»£ç ä¸­æœ€åçš„`defer`è¯­å¥é¦–å…ˆè¢«æ‰§è¡Œã€‚
```swift
func processFile(filename: String) throws {
    if exists(filename) {
        let file = open(filename)
        defer {
            close(file)
        }
        while let line = try file.readline() {
            // Work with the file.
        }
        // close(file) is called here, at the end of the scope.
    }
}
```

ä¸Šé¢çš„ä¾‹å­ç”¨`defer`è¯­å¥ç¡®ä¿`open(_:)`å‡½æ•°ä¼šç›¸åº”åœ°è°ƒç”¨`close(_:)`ã€‚

> æ³¨æ„ï¼š
> å³ä½¿ä¸æ¶‰åŠåˆ°é”™è¯¯å¤„ç†ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨`defer`è¯­å¥ã€‚

[< å¯é€‰é“¾](Optional_Chaining.md) || [ç±»å‹è½¬æ¢ >](Type_Casting.md)
